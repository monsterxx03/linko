# Linko - ç½‘ç»œä»£ç†å’Œæµé‡åˆ†æå·¥å…·

Linko æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ç½‘ç»œä»£ç†æœåŠ¡å™¨ï¼Œå…·æœ‰DNSåˆ†æµã€æµé‡åˆ†æå’Œå¤šåè®®æ”¯æŒåŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **é€æ˜ä»£ç†**ï¼šæ”¯æŒTCPæµé‡è½¬å‘å’ŒDNS UDP 53ç«¯å£
- **DNSåˆ†æµ**ï¼šåŸºäºIPåœ°ç†ä½ç½®çš„æ™ºèƒ½DNSè§£æï¼ˆå›½å†…/å›½å¤–åˆ†æµï¼‰
- **å¤šåè®®æ”¯æŒ**ï¼šSOCKS5ã€HTTPéš§é“ã€Shadowsocksåè®®ï¼ˆè®¡åˆ’ä¸­ï¼‰
- **æµé‡åˆ†æ**ï¼šå®æ—¶æµé‡ç»Ÿè®¡å’Œå†å²æ•°æ®åˆ†æ
- **SNIæå–**ï¼šä»HTTPSæ¡æ‰‹åŒ…ä¸­æå–ä¸»æœºä¿¡æ¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

- Go 1.19+
- macOS æˆ– Linux
- ç®¡ç†å‘˜æƒé™ï¼ˆç”¨äºé…ç½®é˜²ç«å¢™è§„åˆ™ï¼‰

### å®‰è£…

1. å…‹éš†é¡¹ç›®ï¼š
```bash
git clone https://github.com/monsterxx03/linko.git
cd linko
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
make deps
```

3. ä¸‹è½½GeoIPæ•°æ®åº“ï¼š
```bash
make download-geoip
# æˆ–è€…æ‰‹åŠ¨ä¸‹è½½å¹¶æ”¾ç½®åˆ° data/geoip.mmdb
```

4. ç”Ÿæˆé»˜è®¤é…ç½®ï¼š
```bash
make config
```

5. æ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼š
```bash
make build
```

### è¿è¡Œ

```bash
./bin/linko -c config/linko.yaml
```

### å¼€å‘æ¨¡å¼

```bash
make run
```

## ğŸ“‹ é…ç½®è¯´æ˜

è¯¦ç»†é…ç½®é€‰é¡¹è¯·å‚è€ƒ `config/linko.yaml`ï¼š

### DNSé…ç½®

- `listen_addr`: DNSæœåŠ¡å™¨ç›‘å¬åœ°å€
- `domestic_dns`: å›½å†…DNSæœåŠ¡å™¨åˆ—è¡¨
- `foreign_dns`: å›½å¤–DNSæœåŠ¡å™¨åˆ—è¡¨
- `ipdb_path`: GeoIPæ•°æ®åº“æ–‡ä»¶è·¯å¾„
- `tcp_for_foreign`: å¯¹å›½å¤–DNSæŸ¥è¯¢ä½¿ç”¨TCPåè®®

### ä»£ç†é…ç½®

- `socks5`: å¯ç”¨SOCKS5ä»£ç†
- `http_tunnel`: å¯ç”¨HTTP CONNECTéš§é“
- `shadowsocks`: å¯ç”¨Shadowsocksåè®®

### æµé‡ç»Ÿè®¡

- `enable_realtime`: å¯ç”¨å®æ—¶ç»Ÿè®¡
- `enable_history`: å¯ç”¨å†å²ç»Ÿè®¡
- `update_interval`: ç»Ÿè®¡æ›´æ–°é—´éš”

## ğŸ§ª æµ‹è¯•

è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š
```bash
make test
```

è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼š
```bash
make test-coverage
```

è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š
```bash
make bench
```

## ğŸ“Š é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é€æ˜ä»£ç†å±‚      â”‚    â”‚    DNSåˆ†æµå±‚      â”‚    â”‚   åè®®é€‚é…å±‚     â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ â€¢ TCPè½¬å‘       â”‚â—„â”€â”€â–ºâ”‚ â€¢ å›½å†…/å›½å¤–åˆ†æµ   â”‚â—„â”€â”€â–ºâ”‚ â€¢ SOCKS5       â”‚
â”‚ â€¢ UDP(53ç«¯å£)  â”‚    â”‚ â€¢ IPåœ°ç†ä½ç½®æŸ¥è¯¢  â”‚    â”‚ â€¢ HTTP Tunnel   â”‚
â”‚ â€¢ pfctlé…ç½®     â”‚    â”‚ â€¢ DNSç¼“å­˜        â”‚    â”‚ â€¢ Shadowsocks   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ºï¸ å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¶æ„å’ŒDNSåˆ†æµ âœ…
- [x] é¡¹ç›®ç»“æ„è®¾è®¡
- [x] IPåœ°ç†æ•°æ®åº“é›†æˆ
- [x] DNSåˆ†æµå™¨å®ç°
- [x] åŸºç¡€é…ç½®ç®¡ç†
- [x] DNSæœåŠ¡å™¨(UDP/TCP)
- [x] DNSç¼“å­˜æœºåˆ¶

### Phase 2: æ ¸å¿ƒä»£ç†å±‚ âœ…
- [x] SOCKS5åè®®å®ç°
- [x] é€æ˜ä»£ç†æ ¸å¿ƒé€»è¾‘
- [x] è¿æ¥æ± å’Œè¿æ¥ç®¡ç†
- [x] é”™è¯¯å¤„ç†å’Œé‡è¿æœºåˆ¶
- [x] macOS/Linuxé˜²ç«å¢™é…ç½®
- [x] æµé‡é™æµå’Œç®¡ç†

### Phase 3: æµé‡åˆ†æå’Œç»Ÿè®¡
- [ ] SNIä¿¡æ¯æå–
- [ ] å®æ—¶æµé‡ç»Ÿè®¡
- [ ] å†å²æ•°æ®å­˜å‚¨
- [ ] Webç®¡ç†ç•Œé¢

### Phase 4: åè®®æ‰©å±•å’Œä¼˜åŒ–
- [ ] HTTP CONNECTéš§é“
- [ ] Shadowsocksåè®®æ”¯æŒ
- [ ] æ€§èƒ½è°ƒä¼˜
- [ ] å®Œæ•´æµ‹è¯•å’Œæ–‡æ¡£

## ğŸ”§ å¼€å‘å·¥å…·

å®‰è£…å¼€å‘ä¾èµ–ï¼š
```bash
make dev-deps
```

æ ¼å¼åŒ–ä»£ç ï¼š
```bash
make fmt
```

ä»£ç æ£€æŸ¥ï¼š
```bash
make lint
```

å®‰å…¨æ£€æŸ¥ï¼š
```bash
make security
```

æ€§èƒ½åˆ†æï¼š
```bash
make profile
```

## ğŸ“¦ æ„å»º

### æœ¬åœ°æ„å»º
```bash
make build
```

### Linuxæ„å»º
```bash
make build-linux
```

### Dockeræ„å»º
```bash
make docker-build
make docker-run
```

## ğŸ“ ä½¿ç”¨è¯´æ˜

### åŸºç¡€ä½¿ç”¨

#### å¯åŠ¨æœåŠ¡å™¨
```bash
# å¯åŠ¨DNSå’ŒSOCKS5ä»£ç†æœåŠ¡å™¨
./bin/linko -c config/linko.yaml

# å¯ç”¨è‡ªåŠ¨é˜²ç«å¢™é…ç½® (éœ€è¦sudoæƒé™)
sudo ./bin/linko --firewall -c config/linko.yaml
```

#### å®¢æˆ·ç«¯é…ç½®

**SOCKS5ä»£ç†**
- ä¸»æœº: 127.0.0.1
- ç«¯å£: 7890

**HTTPä»£ç†**
- ä¸»æœº: 127.0.0.1
- ç«¯å£: 7890

**DNSé…ç½®**
- ä¸»DNS: 127.0.0.1:5353

### é€æ˜ä»£ç†é…ç½®

#### è‡ªåŠ¨é…ç½® (æ¨è)
Linkoæ”¯æŒè‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™ï¼š

```bash
# å¯ç”¨è‡ªåŠ¨é˜²ç«å¢™é…ç½®
sudo ./bin/linko --firewall
```

æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼š
```yaml
firewall:
  enable_auto: true
  proxy_port: "7890"
  redirect_http: true
  redirect_https: true
```

**æ³¨æ„**: è‡ªåŠ¨é…ç½®éœ€è¦sudo/rootæƒé™ï¼Œä¼šè‡ªåŠ¨è®¾ç½®ä»¥ä¸‹è§„åˆ™ï¼š
- HTTP (80) â†’ ä»£ç†ç«¯å£
- HTTPS (443) â†’ ä»£ç†ç«¯å£

#### æ‰‹åŠ¨é…ç½®

##### macOS
```bash
# ä½¿ç”¨pfctlé…ç½®è§„åˆ™
sudo pfctl -f pf.conf
```

##### Linux
```bash
# ä½¿ç”¨iptablesé…ç½®è§„åˆ™
sudo iptables -t nat -A OUTPUT -p tcp --dport 80 -j REDIRECT --to-port 7890
sudo iptables -t nat -A OUTPUT -p tcp --dport 443 -j REDIRECT --to-port 7890
```

### DNSé…ç½®

å°†ç³»ç»ŸDNSè®¾ç½®ä¸ºï¼š
```
127.0.0.1:5353
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Pull Requestå’ŒIssueï¼

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [miekg/dns](https://github.com/miekg/dns) - Goè¯­è¨€DNSåº“
- [geoip2-golang](https://github.com/oschwald/geoip2-golang) - GeoIP2æ•°æ®åº“æ”¯æŒ
- [MaxMind GeoIP2](https://dev.maxmind.com/geoip/) - IPåœ°ç†ä½ç½®æ•°æ®åº“

## âš ï¸ æ³¨æ„äº‹é¡¹

1. éœ€è¦ç®¡ç†å‘˜æƒé™è¿è¡Œï¼ˆç”¨äºé…ç½®é˜²ç«å¢™è§„åˆ™ï¼‰
2. GeoIPæ•°æ®åº“éœ€è¦å®šæœŸæ›´æ–°
3. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·å……åˆ†æµ‹è¯•
4. é€æ˜ä»£ç†åŠŸèƒ½éœ€è¦ç³»ç»Ÿçº§é…ç½®

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ [Issue](https://github.com/monsterxx03/linko/issues)