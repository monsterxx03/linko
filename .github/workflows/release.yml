name: Release

on:
    push:
        tags:
            - 'v*'

permissions:
    contents: write

jobs:
    release:
        runs-on: macos-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Set up Go
              uses: actions/setup-go@v5
              with:
                  go-version: '1.25'

            - name: Get version
              id: version
              run: echo "VERSION=$(git describe --tags --always --dirty 2>/dev/null)" >> $GITHUB_OUTPUT

            - name: Build Darwin arm64
              run: |
                CGO_ENABLED=0 GOOS=darwin GOARCH=arm64 go build -ldflags "-s -w -X github.com/monsterxx03/linko/pkg/version.Version=${{ steps.version.outputs.VERSION }}" -o bin/linko-darwin-arm64 ./cmd/linko

            - name: Build Darwin amd64
              run: |
                CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -ldflags "-s -w -X github.com/monsterxx03/linko/pkg/version.Version=${{ steps.version.outputs.VERSION }}" -o bin/linko-darwin-amd64 ./cmd/linko

            - name: Create Release
              id: create_release
              uses: softprops/action-gh-release@v2
              with:
                  files: |
                      bin/linko-darwin-arm64
                      bin/linko-darwin-amd64
                  tag_name: ${{ github.ref_name }}
                  name: Release ${{ github.ref_name }}
                  draft: false
                  prerelease: false
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
